version: 0.2

phases:
  install:
    commands:
#     - uname -a
#     - lsb_release -a
     - curl -O -L https://github.com/stedolan/jq/releases/download/jq-1.5/jq-linux64
     - chmod +x jq-linux64
     - sudo mv jq-linux64 /usr/bin/jq
#     - jq
#      - apt-get install jq -y
  build:
    commands:
      - echo Build started on `date`
      - aws help
      - echo -----------     --------------         -------------
      - aws ec2 help
#      - mvn test
  post_build:
    commands:
      - echo Build completed on `date`
#      - mvn package
      - echo Running %101%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#      - mvn -f pom-groovy.xml exec:java -Dexec.mainClass="com.mycompany.app.Beta" 
#succeeds calling AWS SDK for S3, but actually that's not my main task right now, so comment it out:
#      - mvn -f pom.xml exec:java -Dexec.mainClass="com.mycompany.app.Beta" 
#      - cat deleteme1002
      - PUBLICIP=`curl http://checkip.amazonaws.com/32`
      - echo 'tennessee'
      - echo PUBLICIP
      - TEMP_SAYNEXT_SECGRP=`aws ec2 describe-security-groups --region us-west-2 | jq '.SecurityGroups | .[] | select((.GroupName | contains("saynext"))) | .GroupId' | sed s/\"//g`
      - aws ec2 authorize-security-group-ingress --group-id $TEMP_SAYNEXT_SECGRP --cidr $PUBLICIP/32 --port 8080 --protocol tcp --region us-west-2
      - echo 'virginia'
      
#      - aws s3 ls
artifacts:
  files:
    - target/MyGroovy-1.0-SNAPSHOT.jar
